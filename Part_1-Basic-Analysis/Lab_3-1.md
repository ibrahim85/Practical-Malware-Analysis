#### Lab 3-1

Analyze the malware found in the file ```Lab03-01.exe``` using basic dynamic analysis tools.

1. What are this malware’s imports and strings?

	Program might be packed as there is only one import ``ExitProcess``

	- ``Imports``
	
	![Image of Lab3](images/Lab_3-1/1.jpeg)
	
	- ``Strings``

	Reveal registry location, domain name, ``WinVMX32``, ``VideoDriver``, and ``vmx32to64.exe``.
	
	```sh
	C:\Users\Win7-32>strings "C:\Users\Win7-32\Desktop\PracticalMalwareAnalysis-Labs-master\Practical Malware Analysis Labs\BinaryCollection\Chapter_3L\Lab03-01.exe"
	
	Strings v2.53 - Search for ANSI and Unicode strings in binary images.
	Copyright (C) 1999-2016 Mark Russinovich
	Sysinternals - www.sysinternals.com
	
	!This program cannot be run in DOS mode.
	Rich
	.text
	`.data
	ExitProcess
	kernel32.dll
	ws2_32
	A)|
	-~_
	"p7
	cks=u
	ttp=
	cks=
	CONNECT %s:%i HTTP/1.0
	QSRW
	?503
	200
	PWW
	thj@h
	PWW
	VSWRQ
	YZ_[^
	f5
	YZ_[^
	D$0
	D$0
	D$0
	D$0
	D$0
	D$0
	|$,
	D$0
	t$,
	D$0
	t$,
	|$,
	D$4
	D$4
	D$4
	D$4
	D$4
	D$4
	D$4
	D$4
	D$4
	D$4
	G]=
	QVlM
	4~v
	X:a
	3sg
	6I*h<8
	^-m-m<|<|<|M
	o/o/
	00U
	advapi32
	ntdll
	user32
	Jbh
	ww!
	1+KY
	x{w
	#%li
	}>*K
	40j
	QQVP
	ucj
	jjjjjj
	advpack
	hk7
	~Pj
	<2f
	StubPath
	SOFTWARE\Classes\http\shell\open\commandV
	Software\Microsoft\Active Setup\Installed Components\
	test
	 www.practicalmalwareanalysis.com
	admin
	VideoDriver
	WinVMX32-
	vmx32to64.exe
	SOFTWARE\Microsoft\Windows\CurrentVersion\Run
	Ph?
	V5h
	V)V
	SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
	PWj
	AppData
	j@h
	VQj
	ViW
	V%X_
	
	C:\Users\Win7-32>
	```
2. What are the malware’s host-based indicators?

	- ProcMon
	- ProcessExplorer
	- Wireshark
	- ``nc`` on 80
	- ``nc`` on 443
	- ApateDNS
	
	![Image of Lab3](images/Lab_3-1/2.jpeg)
	
	In ``Process Explorer``
	
	View &rarr; Lower Pane View &rarr; Handles
	
	![Image of Lab3](images/Lab_3-1/3.jpeg)
	
	Malware has created the mutex named ```WinVMX32```
	
	![Image of Lab3](images/Lab_3-1/5.jpeg)
	
	View &rarr; Lower Pane View &rarr; DLLs
	
	![Image of Lab3](images/Lab_3-1/4.jpeg)
	
	Malware has dynamically loaded DLLs such as ``ws2_32.dll`` and ``wshtcpip.dll``, which means that it has networking functionality
	
	In ``Process Monitor``
	
	![Image of Lab3](images/Lab_3-1/6.jpeg)
	
	Only one entry for ``WriteFile``, and there are nine entries for ``RegSetValue``.
	
	![Image of Lab3](images/Lab_3-1/7.jpeg)
	
	``WriteFile`` wrote 7,168 bytes to ``C:\WINDOWS\system32\vmx32to64.exe``, which happens to be the same size as that of the file ``Lab03-01.exe``. Also has the same MD5 hash as ``Lab03-01.exe``
	
	**``vmx32to64.exe``** is a host-based indicator for the malware because it uses a hard-coded filename.
	
	```
	HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\VideoDriver:C:\WINDOWS\system32\vmx32to64.exe
	```
	
	The registry entry will run ``vmx32to64.exe`` on system startup.
3. Are there any useful network-based signatures for this malware? If so, what are they?

	``ApateDNS`` shows that a request to ``www.practicalmalwareanalysis.com`` has been made.
	
	![Image of Lab3](images/Lab_3-1/8.jpeg)
	
	The malware appears to beacon out over port ``443``. (Use ```INetSim``` to listen on all ports at once.) Running the test several times shows that the data appears to be random each time. A follow-up in Wireshark tells us that the beacon packets are of consistent size (```256 bytes```) and appear to contain random data not related to the SSL protocol that normally operates over port ``443``.